<script type="text/javascript">
    // Get translation span
    var translations = document.querySelectorAll("[class=aecf-translation]");

    // For each translation add event listener on click for display input and send edit translation
    for (var i = 0; i < translations.length; i++) {
        translations[i].addEventListener("click", function(event) {
            // Hide span block
            event.srcElement.style.display = 'none';

            // Show input element
            event.srcElement.nextElementSibling.style.display = 'block';

            // Event on focus out
            event.srcElement.nextElementSibling.addEventListener("focusout", function(event) {
                // Construct Ajax Request
                var xhttp = new XMLHttpRequest(),
                        id = event.srcElement.getAttribute('id'),
                        translation = event.srcElement.value,
                        domain = event.srcElement.getAttribute('data-domain');

                xhttp.open("POST", "{{ path('aecf_translatortool_default_edit') }}", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send("id=" + id + "&translation=" + translation + "&domain=" + domain);

                // Callback Ajax Request Complete
                xhttp.onreadystatechange = function() {
                    if (xhttp.readyState == 4) {
                        if (xhttp.status == 200) {
                            var res = JSON.parse(xhttp.response).params;

                            // Check response consistency
                            if (res.id == id && res.translation == translation && res.domain == domain) {
                                // Hide input element
                                event.srcElement.style.display = 'none';

                                // Show span block
                                event.srcElement.previousElementSibling.style.display = 'block';
                                event.srcElement.previousElementSibling.textContent = res.translation;
                            } else {
                                alert('An error occured. Please retry.');
                            }
                        } else {
                            alert('An error occured. Please retry.');
                        }
                    }
                } // xhttp-onreadystatechange
            }); // event-focusout
        });
    }
</script>